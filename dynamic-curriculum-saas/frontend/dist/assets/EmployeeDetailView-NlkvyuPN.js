import{g as x,y as A,n as P,c as o,o as n,a as e,k as w,e as _,p as V,t as v,u as y,F as G,s as I,d as k,_ as M,j as z,q as T,w as S,r as j,m as B,T as F,i as O}from"./index-Cm3Rla8a.js";import{u as L}from"./employeeStore-CWFifNve.js";import{_ as J}from"./PathStep-CRZLe23l.js";import{_ as R}from"./EmployeeForm-DU3fjp25.js";const H={class:"space-y-6"},q={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 pt-4"},U={key:0,class:"text-xs text-slate-400"},W={key:1,class:"text-xs text-slate-400"},Y=["disabled"],K={key:0,class:"w-5 h-5 mr-2 transition-transform duration-300 group-hover:rotate-[20deg]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Q={key:1,class:"animate-subtle-pulse"},X={key:2},Z={key:0,class:"bg-yellow-800/30 border border-yellow-700 text-yellow-300 px-4 py-3 rounded-lg text-sm"},ee={key:1,class:"bg-red-800/30 border border-red-700 text-red-300 px-4 py-3 rounded-lg text-sm space-y-2"},te={key:0,class:"text-xs cursor-pointer"},ae={class:"mt-2 bg-slate-700 p-2 rounded overflow-x-auto whitespace-pre-wrap"},le={key:2,class:"space-y-4 mt-6"},se={class:"mt-8 flex flex-col sm:flex-row justify-end gap-3 border-t border-slate-700 pt-6"},oe=["disabled"],ne={key:0,class:"animate-subtle-pulse"},re={key:1},ie=["disabled"],de={key:0,class:"animate-subtle-pulse"},ue={key:1},pe={key:3,class:"card-intellipath p-8 text-center text-slate-400"},me={key:4},ce={key:5},ye={__name:"PathGeneratorForm",props:{employee:Object},setup(u){const p=u,m=L(),a=x([]),c=x(!1),r=x(!1),h=x(""),i=x(null),f=x(null);A(()=>p.employee,l=>{i.value=null,f.value=null,l&&l.learningPath&&l.learningPath.path_data?a.value=JSON.parse(JSON.stringify(l.learningPath.path_data)).map((t,d)=>({id:t.id||`step-temp-${Date.now()}-${d}`,completed:typeof t.completed=="boolean"?t.completed:!1,...t})):a.value=[]},{immediate:!0,deep:!0});const b=P(()=>!(p.employee&&p.employee.current_skills&&p.employee.desired_skills_goal)),E=P(()=>m.isLoading&&c.value||b.value),g=async()=>{if(!p.employee||!p.employee.id){i.value="No employee selected or employee ID is missing.";return}if(b.value){console.warn("Prerequisites for path generation not met.");return}if(!(a.value.length>0&&!window.confirm("This will discard any unsaved changes to the current path and generate a new one. Continue?"))){c.value=!0,i.value=null,f.value=null;try{const l=await m.generateLearningPathForEmployee(p.employee.id);l&&l.error?(i.value=l.error,f.value=l.raw||null,a.value=[]):l&&Array.isArray(l.path_data)?a.value=JSON.parse(JSON.stringify(l.path_data)).map((t,d)=>({id:t.id||`step-temp-${Date.now()}-${d}`,completed:typeof t.completed=="boolean"?t.completed:!1,...t})):l&&Array.isArray(l)&&(a.value=JSON.parse(JSON.stringify(l)).map((t,d)=>({id:t.id||`step-temp-${Date.now()}-${d}`,completed:typeof t.completed=="boolean"?t.completed:!1,...t})))}catch(l){console.error("Critical error during path generation call:",l),i.value=l.message||"An unexpected critical error occurred.",f.value=l.raw||l.details||l.toString(),a.value=[]}finally{c.value=!1}}},s=(l,t)=>{a.value&&a.value[t]&&(a.value[t]={...a.value[t],...l})},$=(l,t)=>{a.value&&a.value[l]&&(a.value[l].completed=t)},C=async l=>{if(!p.employee||!p.employee.learningPath||!p.employee.learningPath.id){alert("No learning path ID found. Generate or load a path first.");return}if(!((!a.value||a.value.length===0)&&!window.confirm("The learning path is empty. Do you want to save an empty path?"))){r.value=!0,h.value=l,i.value=null,f.value=null;try{const t=a.value.map(d=>({topic:d.topic,description:d.description,suggested_link:d.suggested_link,completed:d.completed}));await m.curatePath(p.employee.learningPath.id,{path_data:t,status:l}),alert(`Path successfully ${l==="assigned"?"assigned to employee":"saved as draft"}!`)}catch(t){console.error("Error saving curated path:",t),i.value=t.message||`Failed to ${l==="assigned"?"assign":"save draft"}.`}finally{r.value=!1,h.value=""}}},N=l=>{switch(l){case"draft":return"bg-yellow-500/20 text-yellow-300 border border-yellow-600";case"assigned":return"bg-blue-500/20 text-blue-300 border border-blue-600";case"in_progress":return"bg-sky-500/20 text-sky-300 border border-sky-600";case"completed":return"bg-emerald-500/20 text-emerald-300 border border-emerald-600";default:return"bg-slate-700/50 text-slate-400 border border-slate-600"}};return(l,t)=>(n(),o("div",H,[e("div",q,[e("div",null,[u.employee&&u.employee.learningPath?(n(),o("p",U,[t[2]||(t[2]=_(" Current Path Status: ")),e("span",{class:V(["font-medium capitalize px-2 py-0.5 rounded-full",N(u.employee.learningPath.status)])},v(u.employee.learningPath.status||"N/A"),3)])):(n(),o("p",W,"No learning path exists for this employee yet."))]),e("button",{onClick:g,disabled:E.value,class:"btn-intellipath-primary w-full sm:w-auto !py-2.5 !px-5 text-sm group",title:"Generates a new path. Existing unsaved changes to the current path will be lost."},[y(m).isLoading&&c.value?w("",!0):(n(),o("svg",K,t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 16v-2m0-8a4 4 0 00-4 4h8a4 4 0 00-4-4z"},null,-1)]))),y(m).isLoading&&c.value?(n(),o("span",Q,"Generating...")):(n(),o("span",X,v(u.employee&&u.employee.learningPath?"Regenerate Path with AI":"Generate Path with AI"),1))],8,Y)]),b.value?(n(),o("div",Z,t[4]||(t[4]=[e("p",null,` Please ensure the employee's "Current Skills" and "Desired Skills/Goal" are defined in their profile before generating a learning path. `,-1)]))):w("",!0),i.value?(n(),o("div",ee,[t[6]||(t[6]=e("p",{class:"font-semibold"},"Error Generating Learning Path:",-1)),e("p",null,v(i.value),1),f.value?(n(),o("details",te,[t[5]||(t[5]=e("summary",{class:"outline-none focus:ring-1 focus:ring-red-400 rounded"},"Show raw AI output/error",-1)),e("pre",ae,v(f.value),1)])):w("",!0)])):w("",!0),a.value&&a.value.length>0?(n(),o("div",le,[t[7]||(t[7]=e("h4",{class:"text-md font-semibold text-slate-100"},"Generated Path Steps (Editable by L&D Manager):",-1)),(n(!0),o(G,null,I(a.value,(d,D)=>(n(),o("div",{key:d.id||`step-${D}`,class:"card-intellipath p-4 md:p-5"},[k(J,{"step-data":d,index:D,"is-editable":!0,"onUpdate:step":s,onToggleComplete:$},null,8,["step-data","index"])]))),128)),e("div",se,[e("button",{onClick:t[0]||(t[0]=d=>C("draft")),class:"btn-intellipath-secondary",disabled:y(m).isLoading&&r.value},[y(m).isLoading&&r.value&&h.value==="draft"?(n(),o("span",ne,"Saving Draft...")):(n(),o("span",re,"Save as Draft"))],8,oe),e("button",{onClick:t[1]||(t[1]=d=>C("assigned")),class:"btn-intellipath-primary",disabled:y(m).isLoading&&r.value},[y(m).isLoading&&r.value&&h.value==="assigned"?(n(),o("span",de,"Saving & Assigning...")):(n(),o("span",ue,"Save and Assign Path"))],8,ie)])])):y(m).isLoading&&c.value?(n(),o("div",pe,t[8]||(t[8]=[e("p",{class:"animate-pulse text-lg"},"Crafting personalized learning journey...",-1),e("p",{class:"text-sm mt-2"},"This may take a moment.",-1)]))):!i.value&&(!a.value||a.value.length===0)&&u.employee&&!u.employee.learningPath?(n(),o("div",me,t[9]||(t[9]=[e("div",{class:"card-intellipath p-6 text-center text-slate-400"},[e("p",null,"No learning path has been generated for this employee yet."),e("p",{class:"mt-1 text-sm"},'Click "Generate Path with AI" to create one.')],-1)]))):!i.value&&(!a.value||a.value.length===0)&&u.employee&&u.employee.learningPath&&u.employee.learningPath.path_data&&u.employee.learningPath.path_data.length===0?(n(),o("div",ce,t[10]||(t[10]=[e("div",{class:"card-intellipath p-6 text-center text-slate-400"},[e("p",null,"The current learning path is empty."),e("p",{class:"mt-1 text-sm"},'You can "Regenerate Path with AI" or manually add steps (if that feature exists).')],-1)]))):w("",!0)]))}},ve={class:"p-4 md:p-8 space-y-8"},ge={key:0,class:"card-intellipath p-10 text-center"},he={key:1,class:"card-intellipath p-6 text-red-400 bg-red-900/30"},fe={key:2,class:"space-y-8"},xe={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},be={class:"text-3xl md:text-4xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300"},we={class:"text-slate-400 text-lg mt-1"},ke={class:"flex-shrink-0 flex gap-3"},_e={class:"card-intellipath p-6 md:p-8"},$e={class:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4"},Pe={class:"mt-1 text-slate-200"},Ee={class:"mt-1 text-slate-200"},Ce={class:"sm:col-span-2"},Se={class:"mt-1 text-slate-300 bg-slate-800/50 p-3 rounded-md whitespace-pre-wrap text-sm leading-relaxed min-h-[60px]"},De={class:"sm:col-span-2"},Ae={class:"mt-1 text-slate-300 bg-slate-800/50 p-3 rounded-md whitespace-pre-wrap text-sm leading-relaxed min-h-[60px]"},Le={class:"card-intellipath p-6 md:p-8"},Ne={key:3,class:"card-intellipath p-10 text-center"},Ve={class:"card-intellipath w-full max-w-lg p-6 md:p-8",role:"dialog","aria-modal":"true","aria-labelledby":"edit-employee-modal-title"},Ge={__name:"EmployeeDetailView",setup(u){const p=z(),m=O(),a=L(),c=P(()=>p.params.id),r=P(()=>a.currentEmployee),h=x(!1),i=async g=>{console.log("EmployeeDetailView: Fetching data for employee ID:",g),await a.fetchEmployeeById(g),console.log("EmployeeDetailView: Employee data fetched:",a.currentEmployee)};T(()=>{c.value&&i(c.value)}),A(c,(g,s)=>{g&&g!==s&&i(g)});const f=async()=>{h.value=!1,c.value&&await i(c.value),console.log("EmployeeDetailView: Employee info updated.")},b=()=>{h.value=!1,a.error&&(a.error=null)},E=async()=>{r.value&&window.confirm(`Are you sure you want to delete ${r.value.name}? This action cannot be undone and will remove their learning path.`)&&(await a.deleteEmployee(r.value.id)?(alert(`${r.value.name} has been deleted.`),m.push("/dashboard")):alert(`Failed to delete employee: ${a.error||"Unknown error. Check console."}`))};return(g,s)=>{const $=j("router-link");return n(),o("div",ve,[y(a).isLoading&&!y(a).currentEmployee?(n(),o("div",ge,s[1]||(s[1]=[e("p",{class:"text-slate-400 animate-pulse"},"Loading employee details...",-1)]))):y(a).error&&!y(a).currentEmployee?(n(),o("div",he,[s[3]||(s[3]=e("h2",{class:"text-xl font-semibold mb-2"},"Error Loading Employee",-1)),e("p",null,v(y(a).error),1),k($,{to:"/dashboard",class:"btn-intellipath-secondary mt-4 inline-block"},{default:S(()=>s[2]||(s[2]=[_(" Back to Dashboard ")])),_:1,__:[2]})])):r.value?(n(),o("div",fe,[e("header",xe,[e("div",null,[e("h1",be,v(r.value.name),1),e("p",we,v(r.value.current_role||"Role not specified"),1)]),e("div",ke,[e("button",{onClick:s[0]||(s[0]=C=>h.value=!0),class:"btn-intellipath-secondary"},s[4]||(s[4]=[e("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),e("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1),_(" Edit Info ")])),e("button",{onClick:E,class:"btn-intellipath-danger"},s[5]||(s[5]=[e("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),_(" Delete ")]))])]),e("div",_e,[s[10]||(s[10]=e("h2",{class:"text-xl font-semibold mb-4 text-sky-400 border-b border-slate-700 pb-2"}," Employee Information ",-1)),e("dl",$e,[e("div",null,[s[6]||(s[6]=e("dt",{class:"text-sm font-medium text-slate-400"},"Email",-1)),e("dd",Pe,v(r.value.email||"N/A"),1)]),e("div",null,[s[7]||(s[7]=e("dt",{class:"text-sm font-medium text-slate-400"},"Company Role",-1)),e("dd",Ee,v(r.value.current_role||"N/A"),1)]),e("div",Ce,[s[8]||(s[8]=e("dt",{class:"text-sm font-medium text-slate-400"},"Current Skills",-1)),e("dd",Se,v(r.value.current_skills||"No skills listed."),1)]),e("div",De,[s[9]||(s[9]=e("dt",{class:"text-sm font-medium text-slate-400"},"Desired Skills / Career Goal",-1)),e("dd",Ae,v(r.value.desired_skills_goal||"No goals specified."),1)])])]),e("div",Le,[s[11]||(s[11]=e("h2",{class:"text-xl font-semibold mb-4 text-sky-400 border-b border-slate-700 pb-2"}," Learning Path ",-1)),k(ye,{employee:r.value},null,8,["employee"])])])):(n(),o("div",Ne,[s[13]||(s[13]=e("p",{class:"text-slate-300 text-lg"},"Employee data not found.",-1)),k($,{to:"/dashboard",class:"btn-intellipath-secondary mt-4 inline-block"},{default:S(()=>s[12]||(s[12]=[_(" Back to Dashboard ")])),_:1,__:[12]})])),k(F,{name:"modal-fade"},{default:S(()=>[h.value&&r.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4",onClick:B(b,["self"])},[e("div",Ve,[k(R,{employee:r.value,onSuccess:f,onCancel:b},null,8,["employee"])])])):w("",!0)]),_:1})])}}},je=M(Ge,[["__scopeId","data-v-0c57e461"]]);export{je as default};
